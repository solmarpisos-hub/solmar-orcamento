<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Orçamento Marcelo</title>
<style>
body{font-family:Arial;background:#f2f2f2;padding:20px}
.container{background:#fff;padding:20px;border-radius:10px;max-width:800px;margin:auto}
input,button{padding:8px;margin:5px;width:100%}
button{background:green;color:white;border:none;cursor:pointer}
h2{color:green}
.table{margin-top:20px}
.item{background:#eee;padding:10px;margin:5px 0;border-radius:5px}
</style>
</head>
<body>

<div class="container">
<h2>Orçamento Marcelo</h2>

<input type="text" id="cliente" placeholder="Nome do Cliente">

<h3>Medidas</h3>
<input type="number" id="largura" placeholder="Largura (m)">
<input type="number" id="comprimento" placeholder="Comprimento (m)">
<input type="number" id="valorMetro" placeholder="Valor do m²">

<h3>Rodapé</h3>
<input type="number" id="valorRodape" placeholder="Valor do metro do rodapé">

<h3>Acréscimo (%)</h3>
<input type="number" id="acrescimo" placeholder="Ex: 10">

<button onclick="calcular()">Calcular</button>

<h3>Resultado</h3>
<div id="resultado"></div>

<button onclick="salvar()">Salvar Orçamento</button>

<h3>Orçamentos Salvos</h3>
<div id="lista"></div>

<h3>Total Vendido no Ano (Fechados)</h3>
<div id="totalAno"></div>

</div>

<script>

const juros = {
1:3.26,2:5.7,3:6.52,4:7.3,5:8.2,6:9.1,
7:9.89,8:10.74,9:11.6,10:12.5,11:13.31,12:14.16
};

let valorBaseGlobal = 0;

function calcular(){
let largura = parseFloat(document.getElementById("largura").value)||0;
let comprimento = parseFloat(document.getElementById("comprimento").value)||0;
let valorMetro = parseFloat(document.getElementById("valorMetro").value)||0;
let valorRodape = parseFloat(document.getElementById("valorRodape").value)||0;
let acrescimo = parseFloat(document.getElementById("acrescimo").value)||0;

let area = largura * comprimento;
let totalMaterial = area * valorMetro;
let metrosRodape = (largura*2)+(comprimento*2);
let totalRodape = metrosRodape * valorRodape;

let subtotal = totalMaterial + totalRodape;
let valorAcrescimo = subtotal * (acrescimo/100);
let totalFinal = subtotal + valorAcrescimo;

valorBaseGlobal = totalFinal;

document.getElementById("resultado").innerHTML =
"Área: "+area.toFixed(2)+" m²<br>"+
"Material: R$ "+totalMaterial.toFixed(2)+"<br>"+
"Rodapé: R$ "+totalRodape.toFixed(2)+"<br>"+
"Acréscimo: R$ "+valorAcrescimo.toFixed(2)+"<br>"+
"<strong>Valor Base: R$ "+totalFinal.toFixed(2)+"</strong><br><br>"+
gerarParcelas(totalFinal);
}

function gerarParcelas(valor){
let texto="<h4>Parcelamento</h4>";
for(let i=1;i<=12;i++){
let totalJuros = valor + (valor*(juros[i]/100));
let parcela = totalJuros/i;
texto+= i+"x ("+juros[i]+"%)<br>"+
"Total: R$ "+totalJuros.toFixed(2)+"<br>"+
"Parcela: R$ "+parcela.toFixed(2)+"<br><br>";
}
return texto;
}

function salvar(){
let cliente = document.getElementById("cliente").value;
if(!cliente || valorBaseGlobal==0){alert("Preencha e calcule primeiro");return;}

let orcamentos = JSON.parse(localStorage.getItem("orcamentos")||"[]");

orcamentos.push({
cliente:cliente,
valor:valorBaseGlobal,
status:"Em aberto",
ano:new Date().getFullYear()
});

localStorage.setItem("orcamentos",JSON.stringify(orcamentos));
listar();
}

function listar(){
let lista=document.getElementById("lista");
let orcamentos = JSON.parse(localStorage.getItem("orcamentos")||"[]");
lista.innerHTML="";

orcamentos.forEach((o,index)=>{
lista.innerHTML+=`
<div class="item">
${o.cliente} - R$ ${o.valor.toFixed(2)} - ${o.status}<br>
<button onclick="ver(${index})">Ver</button>
<button onclick="fechar(${index})">Fechar</button>
<button onclick="excluir(${index})">Excluir</button>
</div>
`;
});

calcularTotalAno();
}

function ver(index){
let orcamentos = JSON.parse(localStorage.getItem("orcamentos")||"[]");
let o = orcamentos[index];

let novaJanela = window.open("","_blank");
novaJanela.document.write(`
<h2>Orçamento de ${o.cliente}</h2>
<p>Status: ${o.status}</p>
<p>Valor Base: R$ ${o.valor.toFixed(2)}</p>
${gerarParcelas(o.valor)}
`);
}

function fechar(index){
let orcamentos = JSON.parse(localStorage.getItem("orcamentos")||"[]");
orcamentos[index].status="Fechado";
localStorage.setItem("orcamentos",JSON.stringify(orcamentos));
listar();
}

function excluir(index){
let orcamentos = JSON.parse(localStorage.getItem("orcamentos")||"[]");
orcamentos.splice(index,1);
localStorage.setItem("orcamentos",JSON.stringify(orcamentos));
listar();
}

function calcularTotalAno(){
let orcamentos = JSON.parse(localStorage.getItem("orcamentos")||"[]");
let anoAtual=new Date().getFullYear();
let total=0;
orcamentos.forEach(o=>{
if(o.status=="Fechado" && o.ano==anoAtual){
total+=o.valor;
}
});
document.getElementById("totalAno").innerHTML="<strong>R$ "+total.toFixed(2)+"</strong>";
}

listar();

</script>
</body>
</html>
